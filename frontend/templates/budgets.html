{% extends "layout.html" %}

{% block title %}Бюджеты - Финансовое приложение{% endblock %}

{% block content %}
<h2>Бюджеты</h2>

<div class="card">
    <div class="card-header">Добавить бюджет</div>
    <form id="budget-form" action="/api/v1/budget/" method="POST">
        <div class="form-group">
            <label>Название</label>
            <input type="text" name="name" required>
        </div>
        <div class="form-group">
            <label>Сумма</label>
            <input type="number" name="amount" step="0.01" required>
        </div>
        <div class="form-group">
            <label>Период</label>
            <select name="period" required>
                <option value="daily">Ежедневно</option>
                <option value="weekly">Еженедельно</option>
                <option value="monthly">Ежемесячно</option>
                <option value="yearly">Ежегодно</option>
            </select>
        </div>
        <div class="form-group">
            <label>Категория</label>
            <select name="category_id" required>
                {% for category in categories %}
                <option value="{{ category.id }}">{{ category.name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label>Дата начала</label>
            <input type="date" name="start_date" value="{{ current_date() }}" required>
        </div>
        <div class="form-group">
            <label>Дата окончания</label>
            <input type="date" name="end_date" required>
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="is_active" checked> Активен
            </label>
        </div>
        <button type="submit" class="btn btn-primary">Добавить</button>
    </form>
</div>

<div class="table-container">
    <table>
        <thead>
            <tr>
                <th>Название</th>
                <th>Сумма</th>
                <th>Период</th>
                <th>Категория</th>
                <th>Дата начала</th>
                <th>Дата окончания</th>
                <th>Статус</th>
                <th>Действия</th>
            </tr>
        </thead>
        <tbody>
            {% if budgets %}
                {% for budget in budgets %}
                <tr>
                    <td><strong>{{ budget.name }}</strong></td>
                    <td>{{ "%.2f"|format(budget.amount) }} ₽</td>
                    <td>{{ budget.period }}</td>
                    <td>{{ budget.category_name or '-' }}</td>
                    <td>{{ budget.start_date }}</td>
                    <td>{{ budget.end_date }}</td>
                    <td>
                        <span style="padding: 2px 5px; border: 1px solid black; font-size: 0.85rem;">
                            {{ 'Активен' if budget.is_active else 'Неактивен' }}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-danger btn-small" onclick="deleteItem('/api/v1/budget/{{ budget.id }}', 'бюджет')">Удалить</button>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td colspan="8" class="empty-state">Нет бюджетов</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
{% endblock %}

